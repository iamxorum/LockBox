<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>LockBox - Password List</title>
    <link rel="icon" type="image/svg+xml" th:href="@{/images/favicon.svg}">
    <link rel="icon" type="image/png" th:href="@{/images/favicon.png}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/lockbox-common.css}">
    <link rel="stylesheet" th:href="@{/css/lockbox-sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/lockbox-tables.css}">
    <link rel="stylesheet" th:href="@{/css/lockbox-animations.css}">
    <script th:replace="~{fragments/theme :: theme-script}"></script>
    <style>
        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            color: white;
            z-index: 1000;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.3s, transform 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            max-width: 350px;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Specific styling for warning toast */
        .toast.warning {
            bottom: 80px; /* Position below normal toast */
            border-left: 4px solid #d97706; /* Darker amber border */
            font-weight: 500;
            display: flex;
            align-items: center;
            padding-left: 16px;
        }
        
        .toast.warning::before {
            content: "⚠️";
            margin-right: 10px;
        }
        
        /* Password table styles - improved column handling */
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }
        
        th {
            text-align: left;
            padding: 12px 16px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        td {
            padding: 12px 16px;
            vertical-align: middle;
        }
        
        .index-header, .index-cell {
            width: 40px;
            text-align: center;
        }
        
        .title-header, .title-cell {
            width: 12%;
        }
        
        .username-header, .username-cell {
            width: 15%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .username-cell {
            word-break: break-all;
            max-width: 200px;
        }
        
        .password-header, .password-cell {
            width: 15%;
        }
        
        .url-header, .url-cell {
            width: 12%;
            word-break: break-all;
        }
        
        .url-cell a {
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
        }
        
        .url-cell a:hover {
            white-space: normal;
            word-break: break-all;
        }
        
        .category-header, .category-cell {
            width: 10%;
        }
        
        .tags-header, .tags-cell {
            width: 15%;
        }
        
        .security-status-header, .security-status-cell {
            width: 8%;
            text-align: center;
        }
        
        .actions-header, .actions-cell {
            width: 13%;
            text-align: right;
            white-space: nowrap;
        }
        
        .password-cell-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .password-mask {
            font-family: monospace;
            letter-spacing: 1px;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
            min-width: 0;
        }
        
        .text-reveal {
            color: var(--text-primary);
            animation: fadeIn 0.3s ease;
        }
        
        .copy-reveal-actions {
            display: flex;
            gap: 5px;
            flex-shrink: 0;
        }
        
        .security-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            color: white;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .security-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }
        
        .security-icon.secure {
            background-color: #10b981;
        }
        
        .security-icon.warning {
            background-color: #f59e0b;
        }
        
        .security-icon.danger {
            background-color: #ef4444;
            animation: pulse 2s infinite;
        }
        
        /* Add pulse animation for critical risk */
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                box-shadow: 0 0 0 6px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .btn.copy-btn {
            padding: 6px 8px;
            font-size: 0.8rem;
            white-space: nowrap;
            min-width: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn.copy-btn svg {
            margin-right: 4px;
            flex-shrink: 0;
        }
        
        .password-cell {
            white-space: nowrap;
            overflow: hidden;
        }
        
        /* Risk level styling */
        .security-icon.danger.risk-critical {
            background-color: #991b1b; /* Darker red */
            animation: pulse-critical 1.5s infinite;
        }
        
        .security-icon.danger.risk-high {
            background-color: #dc2626; /* Red */
            animation: pulse 2s infinite;
        }
        
        .security-icon.danger.risk-medium {
            background-color: #f43f5e; /* Pinkish red */
            animation: pulse 3s infinite;
        }
        
        .security-icon.danger.risk-low {
            background-color: #ef4444; /* Standard red */
        }
        
        .security-icon.danger.risk-minimal {
            background-color: #f87171; /* Light red */
        }
        
        /* Animation for critical risk */
        @keyframes pulse-critical {
            0% {
                box-shadow: 0 0 0 0 rgba(153, 27, 27, 0.7);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 0 8px rgba(153, 27, 27, 0);
                transform: scale(1.15);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(153, 27, 27, 0);
                transform: scale(1);
            }
        }
        
        @media (max-width: 992px) {
            .copy-reveal-actions {
                flex-direction: column;
            }
            
            .btn.copy-btn {
                padding: 5px;
                width: 80px;
            }
            
            .password-mask {
                max-width: 120px;
            }
        }
        
        @media (max-width: 768px) {
            .password-cell-container {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .copy-reveal-actions {
                flex-direction: row;
                margin-top: 5px;
            }
        }
        
        /* Responsive table */
        @media (max-width: 1200px) {
            .password-cell-container {
                max-width: 100%;
            }
            
            .title-header, .title-cell {
                width: 18%;
            }
            
            .username-header, .username-cell {
                width: 22%;
            }
            
            .password-header, .password-cell {
                width: 25%;
            }
            
            .url-header, .url-cell {
                width: 20%;
            }
        }
        
        @media (max-width: 992px) {
            .password-mask {
                max-width: 100px;
            }
            
            .url-cell {
                max-width: 150px;
            }
            
            .security-status-header, .security-status-cell {
                width: 7%;
            }
            
            .actions-header, .actions-cell {
                width: 12%;
            }
        }
        
        @media (max-width: 768px) {
            table, thead, tbody, th, td, tr {
                display: block;
            }
            
            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            
            tr {
                margin-bottom: 20px;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 10px;
                background-color: var(--bg-card);
            }
            
            td {
                border: none;
                position: relative;
                padding: 8px 8px 8px 50%;
                text-align: left;
                word-break: break-all;
            }
            
            td:before {
                position: absolute;
                left: 10px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
            }
            
            .index-cell:before { content: "#"; }
            .title-cell:before { content: "Title:"; }
            .username-cell:before { content: "Username:"; }
            .password-cell:before { content: "Password:"; }
            .url-cell:before { content: "URL:"; }
            .security-status-cell:before { content: "Security:"; }
            .actions-cell:before { content: "Actions:"; }
            
            .index-cell, .title-cell, .username-cell, .password-cell, 
            .url-cell, .security-status-cell, .actions-cell {
                width: 100%;
                max-width: 100%;
                text-align: left;
            }
            
            .security-status-cell {
                text-align: left;
            }
            
            .actions-cell {
                text-align: left;
            }
        }
        
        /* Tags container */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        
        /* Reuse category-name and tag-chip styles from their respective lists */
        .category-name {
            display: inline-block;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            color: white;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .category-name:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }
        
        .tag-chip {
            display: inline-block;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            color: white;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .tag-chip:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body class="dashboard-body">
    <div class="sidebar-toggle" id="sidebarToggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </div>
    
    <!-- Background elements -->
    <div class="bg-pattern"></div>
    <div class="bg-gradients"></div>

    <div class="dashboard-layout">
        <!-- Use the sidebar fragment with currentPage parameter -->
        <th:block th:replace="~{fragments/sidebar :: sidebar('passwords')}"></th:block>
        
        <div class="main-content-wrapper">
            <div class="main-content">
                <div class="container fade-in">
                    <div class="header">
                        <h1><span class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
                            </svg>
                        </span> Your Passwords</h1>
                        <a href="/passwords/new" class="btn btn-shine">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg> 
                            Add New Password
                        </a>
                    </div>
                    
                    <div class="filters slide-up">
                        <div class="filter-group">
                            <label class="filter-label">Search</label>
                            <input type="text" id="searchFilter" class="search-input" placeholder="Search passwords...">
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">Category</label>
                            <select id="categoryFilter" class="filter-select">
                                <option value="">All Categories</option>
                                <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}">Category Name</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label class="filter-label">Sort By</label>
                            <select id="sortFilter" class="filter-select">
                                <option value="title">Title (A-Z)</option>
                                <option value="title-desc">Title (Z-A)</option>
                                <option value="created">Newest First</option>
                                <option value="created-asc">Oldest First</option>
                            </select>
                        </div>
                        
                        <div class="filter-group" style="flex: 1;">
                            <label class="filter-label">Active Filters</label>
                            <div class="filter-tags" id="activeFilters">
                                <!-- Tags will be added here dynamically -->
                            </div>
                        </div>
                    </div>
                    
                    <div th:if="${passwords.empty}" class="empty-state slide-up">
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
                        </svg>
                        <h3>No Passwords Yet</h3>
                        <p>You haven't saved any passwords yet. Click "Add New Password" to get started.</p>
                        <a href="/passwords/new" class="btn btn-primary btn-shine">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add New Password
                        </a>
                    </div>
                    
                    <table th:if="${!passwords.empty}" class="slide-up">
                        <thead>
                            <tr>
                                <th class="index-header">#</th>
                                <th class="title-header">Title</th>
                                <th class="username-header">Username</th>
                                <th class="password-header">Password</th>
                                <th class="url-header">URL</th>
                                <th class="category-header">Category</th>
                                <th class="tags-header">Tags</th>
                                <th class="security-status-header">Security</th>
                                <th class="actions-header">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="password, passwordStat : ${passwords}" 
                                th:attr="data-category=${password.category != null ? password.category.id : ''}, 
                                         data-created=${#temporals.format(password.createdAt, 'yyyy-MM-dd HH:mm:ss')},
                                         data-index=${passwordStat.count}">
                                <td class="index-cell" th:text="${passwordStat.count}">1</td>
                                <td class="title-cell" th:text="${password.title}">Example Title</td>
                                <td class="username-cell" th:text="${password.username}">example@email.com</td>
                                <td class="password-cell">
                                    <div class="password-cell-container">
                                            <span class="password-mask" th:attr="data-password=${password.passwordValue}">••••••••</span>
                                        <div class="copy-reveal-actions">
                                            <button class="btn copy-btn" th:data-password="${password.passwordValue}">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                                </svg>
                                                Copy
                                            </button>
                                            <button class="btn copy-btn reveal-btn" th:data-password="${password.passwordValue}">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                    <circle cx="12" cy="12" r="3"></circle>
                                                </svg>
                                                Reveal
                                            </button>
                                        </div>
                                    </div>
                                </td>
                                <td class="url-cell">
                                    <a th:if="${password.url}" 
                                       th:href="${password.url}" 
                                       th:text="${password.url}"
                                       target="_blank"
                                       class="url-link">
                                        https://example.com
                                    </a>
                                </td>
                                <td class="category-cell">
                                    <span th:if="${password.category != null}" 
                                          class="category-name" 
                                          th:style="${'background-color: ' + (password.category.color != null ? password.category.color : '#3b82f6')}"
                                          th:text="${password.category.name}">Category Name</span>
                                    <span th:unless="${password.category != null}" class="text-muted">Uncategorized</span>
                                </td>
                                <td class="tags-cell">
                                    <div class="tags-container">
                                        <span th:each="tag : ${password.tags}" 
                                              class="tag-chip"
                                              th:style="${'background-color: ' + (tag.color != null ? tag.color : '#7C3AED')}"
                                              th:text="${tag.name}">Tag Name</span>
                                    </div>
                                </td>
                                <td class="security-status-cell">
                                    <!-- Check security status from metadata - with different icons for risk levels -->
                                    <div th:if="${password.getMetadata('securityStatus') == 'danger'}" 
                                         th:class="${'security-icon danger risk-' + (password.getMetadata('riskLevel') != null ? password.getMetadata('riskLevel') : 'high')}" 
                                         th:title="${password.getMetadata('pwnedCount') != null ? 'Compromised password - ' + password.getMetadata('riskLevel') + ' risk (' + password.getMetadata('pwnedCount') + ' breaches)' : password.getMetadata('securityMessage')}">
                                        
                                        <!-- Critical risk icon (skull) -->
                                        <svg th:if="${password.getMetadata('riskLevel') == 'critical'}" 
                                             xmlns="http://www.w3.org/2000/svg" 
                                             width="16" height="16" 
                                             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="9" cy="7" r="2"/>
                                            <circle cx="15" cy="7" r="2"/>
                                            <path d="M8 20v-2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                            <path d="M12 4a5 5 0 0 1 5 5v3a5 5 0 0 1-10 0V9a5 5 0 0 1 5-5z"/>
                                        </svg>
                                        
                                        <!-- High risk icon (alert triangle) -->
                                        <svg th:if="${password.getMetadata('riskLevel') == 'high' || password.getMetadata('riskLevel') == null}" 
                                             xmlns="http://www.w3.org/2000/svg" 
                                             width="16" height="16" 
                                             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                            <line x1="12" y1="9" x2="12" y2="13"/>
                                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                                        </svg>
                                        
                                        <!-- Medium risk icon (alert circle) -->
                                        <svg th:if="${password.getMetadata('riskLevel') == 'medium'}" 
                                             xmlns="http://www.w3.org/2000/svg" 
                                             width="16" height="16" 
                                             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"/>
                                            <line x1="12" y1="8" x2="12" y2="12"/>
                                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                                        </svg>
                                        
                                        <!-- Low risk icon (alert octagon) -->
                                        <svg th:if="${password.getMetadata('riskLevel') == 'low'}" 
                                             xmlns="http://www.w3.org/2000/svg" 
                                             width="16" height="16" 
                                             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"/>
                                            <line x1="12" y1="8" x2="12" y2="12"/>
                                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                                        </svg>
                                        
                                        <!-- Minimal risk icon (info) -->
                                        <svg th:if="${password.getMetadata('riskLevel') == 'minimal'}" 
                                             xmlns="http://www.w3.org/2000/svg" 
                                             width="16" height="16" 
                                             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"/>
                                            <line x1="12" y1="16" x2="12" y2="12"/>
                                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                                        </svg>
                                    </div>

                                    <!-- Warning status -->
                                    <div th:if="${password.getMetadata('securityStatus') == 'warning'}" 
                                         class="security-icon warning" 
                                         th:title="${password.getMetadata('securityMessage')}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M13.73 21a9.97 9.97 0 0 1-10.68-9.3c-.31-3.3.94-6.6 3.33-8.83C9.16.55 13.88.29 17 2.1"></path>
                                            <path d="M14 2.1a11.2 11.2 0 0 1 8.71 10.2 16.2 16.2 0 0 1-.89 5.61"></path>
                                            <path d="M12 8v4"></path>
                                            <path d="M12 16h.01"></path>
                                        </svg>
                                    </div>

                                    <!-- Secure status -->
                                    <div th:if="${password.getMetadata('securityStatus') == 'secure'}" 
                                         class="security-icon secure" 
                                         th:title="${password.getMetadata('securityMessage')}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                                        </svg>
                                    </div>

                                    <!-- Unknown status (fallback) -->
                                    <div th:if="${password.getMetadata('securityStatus') == 'unknown'}" 
                                         class="security-icon" 
                                         title="Security status unknown">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                        </svg>
                                    </div>
                                </td>
                                <td class="actions-cell">
                                    <div class="actions">
                                        <a th:href="@{/passwords/edit/{id}(id=${password.id})}" 
                                           class="btn">
                                           <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                               <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                               <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                           </svg>
                                           Edit
                                        </a>
                                        <button class="btn btn-danger" 
                                                th:data-id="${password.id}">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                            Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast container -->
    <div class="toast-container"></div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-backdrop" id="deleteModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"></polygon>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                <h3 class="modal-title">Delete Password</h3>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this password? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="cancelDelete">Cancel</button>
                <button class="modal-btn modal-btn-delete" id="confirmDelete">
                    <span class="spinner" style="display: none;"></span>
                    Delete
                </button>
            </div>
        </div>
    </div>

    <script>
        // Sidebar toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.querySelector('.sidebar');
            
            sidebarToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
                document.body.classList.toggle('sidebar-open');
            });
            
            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(event) {
                if (window.innerWidth <= 992 && 
                    !sidebar.contains(event.target) && 
                    !sidebarToggle.contains(event.target) && 
                    sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    document.body.classList.remove('sidebar-open');
                }
            });
        });
    </script>

    <!-- Original script with password list functionality -->
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            // Check for flash messages
            const successMessage = /*[[${success}]]*/ null;
            const errorMessage = /*[[${error}]]*/ null;
            const passwordWarning = /*[[${passwordWarning}]]*/ null;
            
            if (successMessage) {
                showToast(successMessage, 'success');
            }
            
            if (errorMessage) {
                showToast(errorMessage, 'error');
            }
            
            if (passwordWarning) {
                showToast(passwordWarning, 'warning');
            }
            
            // Enhanced toast notification function
            function showToast(message, type = 'info') {
                // Create a new toast element
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                // Add close button
                const closeBtn = document.createElement('button');
                closeBtn.className = 'toast-close';
                closeBtn.innerHTML = '×';
                closeBtn.addEventListener('click', () => {
                    toast.classList.remove('show');
                    toast.classList.add('hide');
                    setTimeout(() => {
                        toast.remove();
                    }, 400); // Match animation duration
                });
                
                // Create toast content
                toast.textContent = message;
                toast.appendChild(closeBtn);
                
                // Add to container
                const container = document.querySelector('.toast-container');
                container.appendChild(toast);
                
                // Show the toast
                setTimeout(() => {
                toast.classList.add('show');
                }, 10);
                
                // Auto dismiss after delay
                const dismissDelay = type === 'warning' ? 8000 : 5000;
                setTimeout(() => {
                    if (toast.parentNode) {
                    toast.classList.remove('show');
                        toast.classList.add('hide');
                        setTimeout(() => {
                            if (toast.parentNode) {
                                toast.remove();
                            }
                        }, 400);
                    }
                }, dismissDelay);
                
                return toast;
            }
            
            // Handle copy password buttons
            document.querySelectorAll('.copy-btn').forEach(button => {
                if (!button.classList.contains('reveal-btn')) {
                button.addEventListener('click', function() {
                    const password = this.getAttribute('data-password');
                    navigator.clipboard.writeText(password)
                        .then(() => showToast('Password copied to clipboard!', 'success'))
                        .catch(() => showToast('Failed to copy password', 'error'));
                    });
                }
            });

            // Handle password reveal buttons
            document.querySelectorAll('.reveal-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const password = this.getAttribute('data-password');
                    const passwordCell = this.closest('.password-cell');
                    const passwordMask = passwordCell.querySelector('.password-mask');
                    
                    if (passwordMask.textContent === '••••••••') {
                        passwordMask.textContent = password;
                        passwordMask.classList.add('text-reveal');
                        this.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                <line x1="1" y1="1" x2="23" y2="23"></line>
                            </svg> Hide`;
                        
                        // Auto-hide after 10 seconds
                        setTimeout(() => {
                            if (passwordMask.textContent !== '••••••••') {
                                passwordMask.textContent = '••••••••';
                                passwordMask.classList.remove('text-reveal');
                                this.innerHTML = `
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg> Reveal`;
                            }
                        }, 10000);
                    } else {
                        passwordMask.textContent = '••••••••';
                        passwordMask.classList.remove('text-reveal');
                        this.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg> Reveal`;
                    }
                });
            });

            // Handle delete buttons
            document.querySelectorAll('.btn-danger').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const modal = document.getElementById('deleteModal');
                    const confirmBtn = document.getElementById('confirmDelete');
                    const cancelBtn = document.getElementById('cancelDelete');
                    const spinner = confirmBtn.querySelector('.spinner');
                    
                    // Show modal
                    modal.classList.add('show');
                    
                    // Handle cancel
                    cancelBtn.onclick = function() {
                        modal.classList.remove('show');
                    };
                    
                    // Handle click outside modal
                    modal.onclick = function(e) {
                        if (e.target === modal) {
                            modal.classList.remove('show');
                        }
                    };
                    
                    // Handle delete confirmation
                    confirmBtn.onclick = function() {
                        // Add loading state
                        confirmBtn.disabled = true;
                        spinner.style.display = 'inline-block';
                        confirmBtn.innerHTML = `<span class="spinner"></span> Deleting...`;
                        
                        fetch(`/api/v1/passwords/${id}`, {
                            method: 'DELETE',
                            headers: {
                                'X-CSRF-TOKEN': document.querySelector('meta[name="_csrf"]').getAttribute('content')
                            }
                        })
                        .then(response => {
                            if (response.ok) {
                                // Add fade-out animation to the row
                                const row = button.closest('tr');
                                row.style.opacity = '0';
                                row.style.transform = 'translateY(20px)';
                                row.style.transition = 'opacity 0.3s, transform 0.3s';
                                
                                // Hide modal
                                modal.classList.remove('show');
                                
                                showToast('Password deleted successfully', 'success');
                                
                                setTimeout(() => {
                                    window.location.reload();
                                }, 300);
                            } else {
                                throw new Error('Failed to delete password');
                            }
                        })
                        .catch(error => {
                            confirmBtn.disabled = false;
                            spinner.style.display = 'none';
                            confirmBtn.innerHTML = 'Delete';
                            modal.classList.remove('show');
                            showToast('Error: ' + error.message, 'error');
                        });
                    };
                });
            });

            // Filter functionality
            const searchFilter = document.getElementById('searchFilter');
            const categoryFilter = document.getElementById('categoryFilter');
            const sortFilter = document.getElementById('sortFilter');
            const activeFilters = document.getElementById('activeFilters');
            const passwords = document.querySelectorAll('tbody tr');
            
            // Filter passwords
            function filterPasswords() {
                const searchTerm = searchFilter.value.toLowerCase();
                const categoryId = categoryFilter.value;
                const sortBy = sortFilter.value;
                let visibleCount = 0;
                
                // Update active filters
                updateActiveFilters(searchTerm, categoryId);
                
                passwords.forEach(row => {
                    const title = row.querySelector('.title-cell').textContent.toLowerCase();
                    const username = row.querySelector('.username-cell').textContent.toLowerCase();
                    const url = row.querySelector('.url-link')?.textContent.toLowerCase() || '';
                    const rowCategoryId = row.getAttribute('data-category');
                    
                    const matchesSearch = !searchTerm || 
                        title.includes(searchTerm) || 
                        username.includes(searchTerm) || 
                        url.includes(searchTerm);
                        
                    const matchesCategory = !categoryId || rowCategoryId === categoryId;
                    
                    if (matchesSearch && matchesCategory) {
                        row.style.display = '';
                        visibleCount++;
                        // Update the index to maintain sequential numbering
                        row.querySelector('.index-cell').textContent = visibleCount;
                    } else {
                        row.style.display = 'none';
                    }
                });
                
                // Check if we have any visible passwords and update empty state
                updateEmptyStateVisibility();
                
                // Sort passwords
                sortPasswords(sortBy);
            }
            
            // Update active filters display
            function updateActiveFilters(searchTerm, categoryId) {
                activeFilters.innerHTML = '';
                
                if (searchTerm) {
                    const tag = document.createElement('div');
                    tag.className = 'tag';
                    tag.innerHTML = `Search: ${searchTerm} <span class="tag-remove" data-filter="search">×</span>`;
                    activeFilters.appendChild(tag);
                    
                    tag.querySelector('.tag-remove').addEventListener('click', () => {
                        searchFilter.value = '';
                        filterPasswords();
                    });
                }
                
                if (categoryId) {
                    const categoryName = categoryFilter.options[categoryFilter.selectedIndex].text;
                    const tag = document.createElement('div');
                    tag.className = 'tag';
                    tag.innerHTML = `Category: ${categoryName} <span class="tag-remove" data-filter="category">×</span>`;
                    activeFilters.appendChild(tag);
                    
                    tag.querySelector('.tag-remove').addEventListener('click', () => {
                        categoryFilter.value = '';
                        filterPasswords();
                    });
                }
            }
            
            // Sort passwords
            function sortPasswords(sortBy) {
                const tbody = document.querySelector('tbody');
                const rows = Array.from(passwords).filter(row => row.style.display !== 'none');
                
                rows.sort((a, b) => {
                    if (sortBy === 'title') {
                        return a.querySelector('.title-cell').textContent.localeCompare(b.querySelector('.title-cell').textContent);
                    } else if (sortBy === 'title-desc') {
                        return b.querySelector('.title-cell').textContent.localeCompare(a.querySelector('.title-cell').textContent);
                    } else if (sortBy === 'created') {
                        return new Date(b.getAttribute('data-created')) - new Date(a.getAttribute('data-created'));
                    } else if (sortBy === 'created-asc') {
                        return new Date(a.getAttribute('data-created')) - new Date(b.getAttribute('data-created'));
                    }
                    return 0;
                });
                
                rows.forEach((row, index) => {
                    tbody.appendChild(row);
                    // Update index number after sorting or filtering
                    row.querySelector('.index-cell').textContent = index + 1;
                });
            }
            
            // Check if there are visible passwords and show/hide empty state
            function updateEmptyStateVisibility() {
                const emptyState = document.querySelector('.empty-state');
                const passwordTable = document.querySelector('.password-table');
                const visibleRows = Array.from(passwords).filter(row => row.style.display !== 'none');
                
                if (visibleRows.length === 0) {
                    if (emptyState) emptyState.style.display = 'flex';
                    if (passwordTable) passwordTable.style.display = 'none';
                        } else {
                    if (emptyState) emptyState.style.display = 'none';
                    if (passwordTable) passwordTable.style.display = 'table';
                }
            }
            
            // Add event listeners
            searchFilter.addEventListener('input', filterPasswords);
            categoryFilter.addEventListener('change', filterPasswords);
            sortFilter.addEventListener('change', filterPasswords);
            
            // Initial application of filters
            filterPasswords();
        });
    </script>
</body>
</html> 